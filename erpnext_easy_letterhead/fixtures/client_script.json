[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Letter Head",
  "enabled": 1,
  "modified": "2021-11-12 22:42:44.709626",
  "name": "Letter Head-Form",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "function show_image_section(frm) {\n    console.log('show_image_section');\n    if(frm.doc.letter_head_name){\n        $('div[data-fieldname=image]').removeClass('hide-control');\n        $('div[data-fieldname=image]').closest('.row').removeClass('empty-section');\n        $('div[data-fieldname=image]').closest('.row').removeClass('hide-control');\n        $('div[data-fieldname=image]').closest('.form-column').removeClass('col-sm-2').addClass('col-sm-4');\n\t}\n}\n\nfrappe.ui.form.on('Letter Head', {\n    refresh(frm) {\n        console.log('refresh');\n\t\tif(frm.doc.easy_mode===1) {\n\t\t    //show_image_section(frm);\n        }\n\t    toggle_fields(frm);\n    },\n\tsetup(frm) {\n\t    console.log('setup');\n\t    frm.toggle_display(['header_section'], true);\n        frm.set_df_property('source', \"depends_on\", \"eval:doc.easy_mode==0\");\n\t\tfrm.set_df_property('letter_head_image_section', \"depends_on\", \"eval:doc.letter_head_name\");\n        frm.set_df_property('disabled', \"depends_on\", \"eval:doc.letter_head_name && !doc.__islocal\");\n        frm.set_df_property('is_default', \"depends_on\", \"eval:doc.letter_head_name && !doc.__islocal\");\n        \n        frm.set_df_property('header_section', \"depends_on\", \"eval:doc.letter_head_name\");\n        frm.set_df_property('column_break_11', \"depends_on\", \"eval:doc.easy_mode==1\");\n        frm.set_df_property('123', \"depends_on\", \"eval:doc.easy_mode==1\");\n        frm.set_df_property('logo_width', \"depends_on\", \"eval:doc.easy_mode==1\");\n        frm.set_df_property('col3', \"depends_on\", \"eval:doc.easy_mode==1\");\n        frm.set_df_property('title_size', \"depends_on\", \"eval:doc.easy_mode==1\");\n        frm.set_df_property('column_break_10', \"depends_on\", \"eval:doc.easy_mode==1\");\n        frm.set_df_property('text_size', \"depends_on\", \"eval:doc.easy_mode==1\");\n        frm.set_df_property('text_align', \"depends_on\", \"eval:doc.easy_mode==1\");\n\n        if(!frm.doc.letter_head_name){\n            frm.doc.letter_head_name = frappe.defaults.get_user_default(\"company\");\n    \t}\n        \n\t\t//frm.trigger(\"easy_mode\");\n        \n\t},\n\teasy_mode(frm) {\n\t    console.log('easy_mode');\n\t    if(!frm.doc.letter_head_name){\n            frappe.throw(__(\"The name is required\"));\n    \t}\n    \t\n\t    toggle_fields(frm);\n\t\tif(frm.doc.easy_mode==1) {\n\t\t    show_image_section(frm);\n\t\t    frm.save();\n\t\t}\n\t},\n\tafter_save(frm){\n\t    console.log('after_save');\n\t\tif(frm.doc.easy_mode==1) {\n    \t\tshow_image_section(frm);\n    \t    frm.reload_doc();\n\t\t}\n    \trefresh_field(frm.doc.image);\n\t},\n\tsource(frm) {\n        //frm.toggle_display(['letter_head_image_section', 'header_section'], true);\n\t},\n\tbusiness_name(frm) {\n\t    frappe.model.set_value(\"business_name\", frm.doc.business_name);\n\t    update_preview(frm);\n\t},\n\taddress(frm) {\n\t    frappe.model.set_value(\"address\", frm.doc.address);\n\t    update_preview(frm);\n\t},\n\tcity_and_country(frm) {\n\t    frappe.model.set_value(\"city_and_country\", frm.doc.city_and_country);\n\t    update_preview(frm);\n\t},\n\tphone_number(frm) {\n\t    frappe.model.set_value(\"phone_number\", frm.doc.phone_number);\n\t\tupdate_preview(frm);\n\t},\n\temail(frm) {\n\t    frappe.model.set_value(\"email\", frm.doc.email);\n\t\tupdate_preview(frm);\n\t},\n\tlogo_width(frm) {\n\t    frappe.model.set_value(\"logo_width\", frm.doc.logo_width);\n\t\tupdate_preview(frm);\n\t},\n\ttext_align(frm) {\n\t    frappe.model.set_value(\"text_align\", frm.doc.text_align);\n\t\tupdate_preview(frm);\n\t},\n\ttext_size(frm) {\n\t    frappe.model.set_value(\"text_size\", frm.doc.text_size);\n\t\tupdate_preview(frm);\n\t},\n\ttitle_size(frm) {\n\t    frappe.model.set_value(\"title_size\", frm.doc.title_size);\n\t\tupdate_preview(frm);\n\t}\n});\n\nfunction update_preview(frm) {\n\tconsole.log('update_preview');\n\tlet business = frm.doc.business_name;\n\tlet address = frm.doc.address + \"<br>\";\n\tlet city_country = frm.doc.city_and_country + \"<br>\";\n\tlet phone =  __(\"Phone: \") + frm.doc.phone_number + \"<br>\";\n\tlet email = __(\"Email: \") + frm.doc.email;\n\t\n\tif (frm.doc.business_name === \"\" || typeof frm.doc.business_name === 'undefined'){\n\t    frm.doc.business_name = frm.doc.letter_head_name;\n\t    business = frm.doc.letter_head_name;\n\t}\n\tif (frm.doc.address === \"\" || typeof frm.doc.address === 'undefined'){\n\t    address = \"\";\n\t}\n\tif (frm.doc.city_and_country === \"\" || typeof frm.doc.city_and_country === 'undefined'){\n\t    city_country = __(\"City, \"+ frappe.defaults.get_user_default(\"country\") +\"<br>\");\n\t}\n\tif (frm.doc.phone_number === '' || typeof frm.doc.phone_number === 'undefined'){\n\t    phone =  \"\";\n\t}\n\tif (frm.doc.email === '' || typeof frm.doc.email === 'undefined'){\n\t    email = \"\";\n\t}\n\t\n\tlet image = \"\";\n    if (frm.doc.image) {\n        image = frm.doc.image;\n    }\n\t\n\tlet html_content = `\n\t\t<table width='100%' style='margin-bottom:0; padding-bottom:0;'>\n            <tbody>\n            <tr>\n                <td width='50%' style='vertical-align: top; padding: 1px 0 0 1px;'>\n                    <img id='logo' src='`+ image +`'\n                        width='`+ frm.doc.logo_width +`' max-height='200' max-width='`+ frm.doc.logo_width +`'/>\n                </td>\n                <td width='50%' id='addr' style='vertical-align: top; text-align: `+ frm.doc.text_align +`; padding-bottom:0;'>\n                    <h`+ frm.doc.title_size +`>`+ business +`</h`+ frm.doc.title_size +`>\n                    <p style='font-size:`+ frm.doc.text_size +`;'>`+ address +`\n                    `+ city_country +`\n                    ` + phone +`\n                    ` + email +`\n                    </p>\n                </td>\n            </tr>\n            </tbody>\n        </table>`;\n\tfrm.doc.content = html_content;\n\trefresh_field('content');\n\tshow_image_section(frm);\n}\n\nfunction toggle_fields(frm){\n    console.log('toggle_fields');\n    if(frm.doc.__islocal){\n        frm.doc.is_default = 1;\n\t\t$(\"select[data-fieldname=source]\").val(\"HTML\").trigger('change');\n    \t$(\".html-preview\").show();\n        frm.toggle_display(['letter_head_image_section', 'header_section'], true);\n    }\n    \n    if(frm.doc.easy_mode===1) {\n\t    $(\"button:contains('Preview'):first\").trigger('click');\n    \t$(\".section-head:contains('Header')\").hide();\n    \t$(\"p:contains('Letter Head in HTML')\").hide();\n    \t$(\"label:contains('Header HTML')\").parent().hide();\n    \t$(\"button:contains('Edit'):first\").hide();\n    \t$(\"button:contains('Expand'):first\").hide();\n    \t$(\".html-preview\").css({'max-height': '220px', 'min-height': '200px'});\n    }\n    else {\n\t    $(\"button:contains('Edit'):first\").trigger('click');\n    \t$(\".section-head:contains('Header')\").show();\n    \t$(\"p:contains('Letter Head in HTML')\").show();\n    \t$(\"label:contains('Header HTML')\").parent().show();\n    \t$(\"button:contains('Edit'):first\").show();\n    \t$(\"button:contains('Expand'):first\").show();\n    \t$(\".html-preview\").css({'max-height': '600px', 'min-height': '260px'});\n    }\n    \n    show_image_section(frm);\n    update_preview(frm);\n\n}",
  "view": "Form"
 }
]
